<!--
* OrderFinalConfirmation - Order Submission page for cash based ordering system
* SFDC Release - https://na29.salesforce.com/a5B34000000xp2Y
* Pivotal Tracker Updates:
* ID #114709951 - Add Contact Phone to the Order Submission Screen - 3/18/16
* ID #114738873 - Purchase Order Re-submission (SFDC) - 4/16/2016
* ID #121852503 - Remove Ok to Ship  - 6/23/2016
* ID #114921295 - Remove Shipping Method Selection - WW32
* ID #131033867 - Real Time Ordering - WW46
*
*
*
*
*
*
*
-->

<apex:page standardController="Purchase_Order__c" extensions="OrderSubmissionDetails" docType="html-5.0" title="Submission Details" cache="true" action="{!init}" showHeader="{!IF(isPartnerUser,false,true)}">

    <script src="https://code.jquery.com/jquery-2.1.4.min.js" />
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>
    <apex:stylesheet value="{!URLFOR($Resource.NSBootstrap, '/NSBootstrap.css')}"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" />

    <style>
        .row-centered {
            text-align:center;
        }
        .bs .label {
            font-size: .90em;
        }

        .bs .body {
            font-size: .90em;
        }
        .bs .form-control {
            font-size: .90em !important;
            height: 90%;
        }
        .bs .table > thead > tr > th, .bs .table > tbody > tr > th, .bs .table > tfoot > tr > th, .bs .table > thead > tr > td, .bs .table > tbody > tr > td, .bs .table > tfoot > tr > td {
            font-size: .90em;
        }
        .bPageBlock {
            border-top: 3px solid #0076be !important;
            border-radius: 0px !important;
        }
        .customnotabTab .secondaryPalette, .individualPalette .customnotabBlock .secondaryPalette {
            background-color: #ffffff !important;
        }
    </style>

    <script type="text/javascript">
        function toggleSpinner(showSpinner){
            if(showSpinner){
                $('#ajaxLoading').show();
            }else{
                $('#ajaxLoading').hide();
            }
        }
    </script>

    <div class="bs">
        <div class="container container-fluid" style="padding-top:1em; width: 80%">
            <apex:form >
                <!-- SOA order messages -->
                <apex:outputPanel id="submittedPanel" rendered="{!purchaseOrder.Order_Status__c == 'Submitted' && (purchaseOrder.Interface_Status__c != '' || purchaseOrder.Interface_Status__c != null)}">
                    <div class="alert alert-info">
                        {!$Label.Order_Submission_Status}
                    </div>
                </apex:outputPanel>
                <apex:outputPanel id="errorPanel" rendered="{!purchaseOrder.Order_Status__c == 'Error' && (purchaseOrder.Interface_Status__c != '' || purchaseOrder.Interface_Status__c != null)}">
                    <div class="alert alert-danger">
                        {!$Label.POWizadErrorMsgForErrorStatusPartners}<br/>
                        <apex:outputField rendered="{!currentUser.Contact.AccountId == null}" value="{!purchaseOrder.Order_Status_Interface_Message__c}"/>
                    </div>
                </apex:outputPanel>
                <apex:outputPanel id="orderNumberPanel" rendered="{!purchaseOrder.Oracle_Order_Number__c != null && (purchaseOrder.Interface_Status__c != '' || purchaseOrder.Interface_Status__c != null)}">
                    <div class="alert alert-success">
                        {!purchaseOrder.Order_Status_Interface_Message__c}
                    </div>
                </apex:outputPanel>

                <!-- Real Time Order Messages -->
                <apex:outputPanel id="sentPanel" rendered="{!purchaseOrder.Oracle_Order_Number__c != null && purchaseOrder.Order_Status__c == 'Processed' && (purchaseOrder.Interface_Status__c = '' || purchaseOrder.Interface_Status__c = null)}">
                    <div class="alert alert-success">
                        {!$Label.OracleNewOrderSuccess}&nbsp;{!purchaseOrder.Oracle_Order_Number__c}
                    </div>
                </apex:outputPanel>
                <apex:outputPanel id="timeoutPanel" rendered="{!retries < 2 && purchaseOrder.Order_Status__c == 'Timeout Error' && (purchaseOrder.Interface_Status__c = '' || purchaseOrder.Interface_Status__c = null)}">
                    <div class="alert alert-info">
                        {!$Label.OracleNewOrderTimeout}&nbsp;&nbsp;<apex:commandButton id="retryButton" styleClass="btn btn-primary btn-sm" action="{!reSubmitOrder}" immediate="true" onclick="toggleSpinner(true);" oncomplete="toggleSpinner(false);" value="{!$Label.OracleResendOrder}"/>
                    </div>
                </apex:outputPanel>
                <apex:outputPanel id="timeoutErrorPanel" rendered="{!retries == 2 && purchaseOrder.Order_Status__c == 'Timeout Error' && (purchaseOrder.Interface_Status__c = '' || purchaseOrder.Interface_Status__c = null)}">
                    <div class="alert alert-danger">
                        {!$Label.OracleNewOrderTimeoutError}
                    </div>
                </apex:outputPanel>
                <apex:outputPanel id="realtimeErrorPanel" rendered="{!purchaseOrder.Order_Status__c == 'Error' && (purchaseOrder.Interface_Status__c = '' || purchaseOrder.Interface_Status__c = null)}">
                    <div class="alert alert-danger">
                        {!$Label.OracleNewOrderFailure}
                    </div>
                </apex:outputPanel>

                <!-- Page failure message -->
                <apex:outputPanel id="errorMsgs" rendered="{!currentUser.Contact.AccountId == null}">
                    <apex:messages styleClass="alert alert-danger" />
                </apex:outputPanel>

                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h4>{!$Label.Order_Confirmation}</h4>
                    </div>

                    <div class="panel-body">
                        <h4>{!$Label.Order_Information}</h4>

                        <!--#114738873-->
                        <apex:outputPanel rendered="{!currentUser.Contact.AccountId == null && purchaseOrder.Order_Status__c == 'Error' && purchaseOrder.Accept_Terms__c}" >
                            <div class="row">
                                <div class="col-sm-12" style="margin-top: 1em;">
                                    <label>Oracle Status&nbsp;-&nbsp;<apex:outputText value="{!purchaseOrder.Order_Status_Interface_Message__c}"/></label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12" style="margin-top: 1em;">
                                    <apex:commandButton styleClass="btn btn-primary btn-sm" action="{!psrSubmitOrder}" value="{!$Label.POWizardSubmitOrderLabel}" onclick="toggleSpinner(true);" oncomplete="toggleSpinner(false);" reRender="errorMsgs" /> &nbsp;&nbsp;
                                </div>
                            </div>
                        </apex:outputPanel>
                        <hr/>
                        <div class="form-horizontal">
                            <div id="ajaxLoading" class="row" style="text-align:center; display: none">
                                <span><i class="fa fa-spinner fa-spin" style="font-size:24px"></i>&nbsp;&nbsp;{!$Label.POWizardPendingStatusText}</span>
                            </div>
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="col-sm-6">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <label for="partnerNameOutput" class="col-sm-4">{!$ObjectType.Purchase_Order__c.Fields.Dealer_Account__c.Label}</label>
                                                    <apex:outputText styleClass="col-sm-8" id="partnerNameOutput" value="{!purchaseOrder.Dealer_Account__r.Name}"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <label for="orderNameOutputDiv" class="col-sm-4">{!$ObjectType.Purchase_Order__c.Fields.Opportunity__c.Label}</label>
                                                    <div class="col-sm-8" id="orderNameOutputDiv">
                                                        <apex:outputField id="oppOuput" value="{!purchaseOrder.Opportunity__r.Name}"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="col-sm-6">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <label for="billingInfoOutput" class="col-sm-4" style="padding-top:8px;">{!$Label.POWizardBillToAddress}</label>
                                                    <div class="col-sm-8">
                                                        <apex:outputField styleClass="form-control" style="width:50%; font-size: .85em;" value="{!bts.Address1__c}"/><br/>
                                                        <apex:outputField styleClass="form-control" style="width:50%; font-size: .85em;" value="{!bts.City__c}" />,&nbsp;
                                                        <apex:outputField styleClass="form-control" style="width:50%; font-size: .85em;" value="{!bts.State__c}" />&nbsp;&nbsp;
                                                        <apex:outputField styleClass="form-control" style="width:50%; font-size: .85em;" value="{!bts.Zip__c}" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <label for="oppOutput" class="col-sm-4">{!$ObjectType.Purchase_Order__c.Fields.Name.Label}</label>
                                                    <apex:outputText styleClass="col-sm-8" id="orderNameOutput" value="{!purchaseOrder.Name}"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="col-sm-6">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <label for="taxableBoxDiv" class="col-sm-4">{!$ObjectType.Purchase_Order__c.Fields.Is_Taxible_Order__c.Label}</label>
                                                    <div id="taxableBoxDiv" >
                                                        <apex:outputText styleClass="col-sm-8" id="taxableBox" value="{!IF(purchaseOrder.Is_Taxible_Order__c == true, 'Yes', 'No')}"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br/>

                            <h4>{!$Label.POWizardShippingInfoTitle}</h4>
                            <hr/>

                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="col-sm-6">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <label for="deliveryDateOutput" class="col-sm-4">{!$ObjectType.Purchase_Order__c.Fields.Requested_Delivery_Date__c.Label}</label>
                                                    <div class="col-sm-8" id="deliveryDateOutput" >
                                                        <apex:outputText value=" {0,date,dd-MMM-yyyy}">
                                                            <apex:param value="{!purchaseOrder.Requested_Delivery_Date__c}" />
                                                        </apex:outputText>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <label for="shipContactPhone" class="col-sm-4">{!$ObjectType.Lead.Fields.Phone.Label}</label>
                                                    <apex:outputText id="shipContactPhone" styleClass="col-sm-8" value="{!purchaseOrder.Ship_to_Contact__r.Phone}"/>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="col-sm-6">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <label for="shippingContactOutput" class="col-sm-4">{!$ObjectType.Purchase_Order__c.Fields.Ship_To_Contact__c.Label}</label>
                                                    <div id="shippingContactOutput" class="col-sm-8">
                                                        <apex:outputText value="{!purchaseOrder.Ship_To_Contact__r.Name}"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <label for="shipToAddressOutput" class="col-sm-4">{!$Label.POWizardShipToAddress}</label>
                                                    <apex:outputText id="shipToAddressOutput" styleClass="col-sm-8" value="{!sts.Address__c}"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label for="specialInstructionsDiv" class="col-sm-4">{!$ObjectType.Purchase_Order__c.Fields.Special_Instructions__c.Label}</label>
                                            <div class="col-sm-8" id="specialInstructionsDiv">
                                                <span id="specinst"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="col-sm-6">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <label class="col-sm-4">{!$ObjectType.Ship_to_Site__c.Fields.DeliverySiteType__c.Label}</label>
                                                    <div class="col-sm-8">
                                                        <span id="dst"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <label class="col-sm-4">{!$ObjectType.Ship_to_Site__c.Fields.DriverAssist__c.Label}</label>
                                                    <div class="col-sm-8">
                                                        <span id="da"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="col-sm-6">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <label class="col-sm-4">{!$ObjectType.Ship_to_Site__c.Fields.SpecialEquipment__c.Label}</label>
                                                    <div class="col-sm-8">
                                                        <span id="se"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <label class="col-sm-4">{!$ObjectType.Ship_to_Site__c.Fields.DropTrailer__c.Label}</label>
                                                    <div class="col-sm-8">
                                                        <span id="dt"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="col-sm-6">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <!-- <label class="col-sm-4">{!$ObjectType.Ship_to_Site__c.Fields.DeliveryTimeStart__c.Label}</label> -->
                                                    <div class="col-sm-8">
                                                        <!-- <span id="dts"></span> -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <label class="col-sm-4">{!$ObjectType.Ship_to_Site__c.Fields.LiftGatePalletJack__c.Label}</label>
                                                    <div class="col-sm-8">
                                                        <span id="lgpj"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="col-sm-6">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <!-- <label class="col-sm-4">{!$ObjectType.Ship_to_Site__c.Fields.DeliveryTimeEnd__c.Label}</label> -->
                                                    <div class="col-sm-8">
                                                        <!-- <span id="dte"></span> -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br/>
                            <br/>
                            
                            <h4>{!$Label.POWizardLineItemsHeading}</h4>
                            <hr/>
                            <div class="row">
                                <div class="col-sm-12">
                                    <apex:dataTable value="{!orderLines}" rows="{!numLines}" var="pol" id="theTable" rowClasses="odd,even" styleClass="table" columns="3">
                                        <apex:column width="60%">
                                            <apex:facet name="header">{!$Label.Description}</apex:facet>
                                            <apex:outputText value="{!pol.Item_Description__c}"/>
                                        </apex:column>
                                        <apex:column >
                                            <apex:facet name="header">{!$Label.PAS_Item}</apex:facet>
                                            <apex:outputText value="{!pol.Item_ID__c}"/>
                                        </apex:column>
                                        <apex:column >
                                            <apex:facet name="header">{!$Label.POWizardQuantityHeading}</apex:facet>
                                            <apex:outputText value="{!pol.Quantity__c}"/>
                                        </apex:column>
                                    </apex:dataTable>
                                </div>
                            </div>
                        </div><!--end panel-->
                    </div>
                </div>
            </apex:form>
        </div><!--end container-->
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            var si = '{!specialInstructions}';
            if(si.includes('|')) {
                var siArray = si.split('|');
                $('#dts').html(siArray[0]);
                $('#dte').html(siArray[1]);
                $('#dst').html(siArray[2]);
                $('#da').html(siArray[3]);
                $('#dt').html(siArray[4]);
                $('#lgpj').html(siArray[5]);
                $('#se').html(siArray[6]);
                $('#specinst').html(siArray[7]);
            } else $('#specinst').html(si);
        });
    </script>
</apex:page>