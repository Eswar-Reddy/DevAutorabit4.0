<apex:page controller="EnergyLinkPreFormController" showHeader="false" language="{!language}">
    <script type='text/javascript'>
        window.resizeTo(730, 600);
    </script>
    <script type="text/javascript">
    var __sfdcSessionId = '{!sessionId}';
    </script>
    <script src="../../soap/ajax/34.0/connection.js" type="text/javascript"></script>
    <script type='text/javascript' src='https://d.la2c1cs.salesforceliveagent.com/content/g/js/32.0/prechat.js'></script>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:600,400' rel='stylesheet' type='text/css' />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" rel="stylesheet" />
    <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js'></script>
    <style type="text/css">

        body {
            cursor: auto;
            font-family: "Open Sans", sans-serif;
            font-style: normal;
            font-weight: normal;
            line-height: 1.5;
            padding: 5px;
        }

        .chat-form-container {
            color: #5e6367;
            -webkit-animation: 0.5s linear show_form;
            -moz-animation: 0.5s linear show_form;
            -o-animation: 0.5s linear show_form;
            -ms-animation: 0.5s linear show_form;
            animation: 0.5s linear show_form;
        }

        @-webkit-keyframes show_form { from { opacity:0; } 50% { opacity: 0; } to { opacity:1; }  }
        @-moz-keyframes show_form { from { opacity:0; } 50% { opacity: 0; } to { opacity:1; }  }
        @-o-keyframes show_form { from { opacity:0; } 50% { opacity: 0; } to { opacity:1; }  }
        @-ms-keyframes show_form { from { opacity:0; } 50% { opacity: 0; } to { opacity:1; }  }
        @keyframes show_form { from { opacity:0; } 50% { opacity: 0; } to { opacity:1; }  }

        .chat-form-container .chat-form-header-wrapper {
            text-align: left;
            font-size: 18px;
            color: #ffffff;
            background-color: #0076be;
            padding: 3px 0 3px 23px;
        }

        .chat-form-container .chat-form {
            margin: 0 25px 10px 25px;
        }

        .chat-form-container .chat-form .chat-title {
            margin: 0 0 22px 0;
            color:#5E6367;
            opacity: 0.8;
            font-size: 16px;
            font-weight: 600;
        margin-top: 10px;
        }

        .chat-form-container .chat-form textarea {
            resize: none;
        }

        .chat-form-container .chat-form .prechat-submit-button {
            float: right;
            background-color: #0076be;
            padding-left: 40px;
            padding-right: 40px;
            background-image: none;
        }

        .chat-form-container .chat-form .prechat-hidden-submit-button {
            display: none;
        }

        .alert-error {
            background-color: #fff;
            color: rgb(239, 55, 62);
            height: 0;
            opacity: 0;
            transition: height ease .2s, opacity ease .2s .2s;
        }

        .alert-show {
            height: 40px;
            opacity: 1;
            padding: 1px 7px 7px 10px;
            font-size: 14px;
        }

        .alert-msg {
            display: none;
        }

        .alert-msg-show {
            display: block;
        }

        input {
            margin-bottom: 5px;
        }

        .submit-hide {
            display: none;
        }

        ::-webkit-input-placeholder {
            opacity: 0.5;
        }
        :-moz-placeholder { /* Firefox 18- */
            opacity: 0.5;
        }
        ::-moz-placeholder {  /* Firefox 19+ */
            opacity: 0.5;
        }
        :-ms-input-placeholder {
            opacity: 0.5;
        }

    .buttonGotIt {
        background-color: #008CBA;
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
    }
    .loadingImageWindowStyle{
        margin-top:30%;
        margin-left:30%;
    }
    .closeWindowStyle{
        width:100%;
        height:100%;
        background-color: white; 
    }
    .tableWindowClose{
        border:none;
        width:100%;
    }
    </style>
    <apex:outputPanel id="paramRefreshPanel">
        <script type='text/javascript'>
            var isAvailable = {!isAvailable};
    var button_id ='{!button_id}';
    var buttonClicked;
    </script>
</apex:outputPanel>
    <script type="text/javascript">
        var contactEmailAddress;
        (function() {
            function handlePageLoad() {
                var endpointMatcher = new RegExp("[\\?\\&]endpoint=([^&#]*)");
                document.getElementById('prechatForm').setAttribute('action',
                        decodeURIComponent(endpointMatcher.exec(document.location.search)[1]));
            }
            if (window.addEventListener) {
                window.addEventListener('load', handlePageLoad, false);
            } else {
                window.attachEvent('onload', handlePageLoad, false);
            }
        })();

        function setName(){
            
            var firstName = document.getElementById("customField1").value;
            var lastName = document.getElementById("customField2").value;
            var emailAddress = document.getElementById("customField3").value;
            var firstNameTrim = myTrim(firstName);
            var lastNameTrim = myTrim(lastName);
            var emailAddressTrim = myTrim(emailAddress);
            if (firstNameTrim != "") {
                document.getElementById("windowName").value = firstNameTrim + " " + lastNameTrim;
            } else if (lastNameTrim != "") {
                document.getElementById("windowName").value = lastNameTrim;
            } else if (emailAddressTrim != "") {
                document.getElementById("windowName").value = emailAddressTrim;
            }
            return true;
        }

        function myTrim(x) {
            return x.replace(/^\s+|\s+$/gm,'');
        }

       
        var initializeChatForm = function (details){
            var remainingDetails = [];
            for (var i = 0; i < details.customDetails.length; i++) {
                switch(details.customDetails[i].label)
                {
                    case 'First Name':
                        var firstNameCtrl = document.getElementById("customField1");
                        firstNameCtrl.value = details.customDetails[i].value;
                        break;
                    case 'Last Name':
                        var lastNameCtrl = document.getElementById("customField2");
                        lastNameCtrl.value = details.customDetails[i].value;
                        break;
                    case 'Email Address':
                        var emailCtrl = document.getElementById("customField3");
                        emailCtrl.value = details.customDetails[i].value;
                        contactEmailAddress = emailCtrl.value;
                        break;
                    case 'Phone Number':
                        var phoneCtrl = document.getElementById("customField4");
                        if(details.customDetails[i].value.substr(0,3)!=="555" && details.customDetails[i].value.substr(0,4)!=="(555"){
                            phoneCtrl.value = details.customDetails[i].value;
                        }
                        break;
                    default:
                        remainingDetails.push(details.customDetails[i]);
                }
            }

            details.customDetails = remainingDetails;
        };

        
        liveagent.details.preChatInit('{!liveAgentUrl}', 'initializeChatForm');
        
    </script>

<apex:pagemessages ></apex:pagemessages> 
    <div id="chat-form-container" class="row chat-form-container">

        <div class="chat-form-header-wrapper">
            Chat with SunPower
        </div>
    <div class="chat-title" style="padding-left: 25px;padding-top: 10px;">
                    What can we help you with?
                </div>

    <form name="prechatForm" method='post' id='prechatForm' class="chat-form" novalidate="true" onsubmit="return validate();">
        <div>
                <div class="row">
                    <div class="small-12 medium-6 columns">
                    <div id="option_error"  style="visibility: hidden;">
                        <span id="option_required" style="color: red;">An option must be selected.</span>
                    </div>
                        <select id="issueCategory" name='liveagent.prechat:Issue Category' class="radius chat-select" required="true">
                            <option value="default">Select</option>
                            <option value="alert">System alert</option>
                            <option value="performance">System performance</option>
                            <option value="missingData">Missing data</option>
                            <option value="billing">Billing issue</option>
                            <option value="inquiry">General inquiry</option>
                        </select>
                    
                    </div>
                </div>
                <div class="row">
                    <div class="small-12 medium-6 columns">
                        <input name='liveagent.prechat:Visitor First Name' id='customField1'  class="radius" type="text"
                               placeholder="first name" required="true"/>
                        <div id="firstName_error" class="alert alert-error alert-below">
                            <span id="firstName_required" class="alert-msg">First name is required.</span>
                            <span id="firstName_min" class="alert-msg">Minimum of 2 characters required.</span>
                        </div>

                    </div>
                    <div class="small-12 medium-6 columns">
                        <input name='liveagent.prechat:Visitor Last Name' id='customField2' class="radius" type="text"
                               placeholder="last name" required="true"/>
                        <div id="lastName_error" class="alert alert-error alert-below">
                            <span id="lastName_required" class="alert-msg">Last name is required.</span>
                            <span id="lastName_min" class="alert-msg">Minimum of 2 characters required.</span>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="small-12 medium-6 columns">
                        <input name='liveagent.prechat:Visitor Email Address'
                               id='customField3'
                               class="radius" type="email" placeholder="email"
                               required="true"/>
                        <div id="email_error" class="alert alert-error alert-below">
                            <span id="email_required" class="alert-msg">Email is required.</span>
                            <span id="email_invalid" class="alert-msg">Please enter a valid email.</span>
                        </div>

                    </div>
                    <div class="small-12 medium-6 columns">
                        <input name='liveagent.prechat:Visitor Phone Number'
                               id='customField4' class="radius"
                               type="text" placeholder="phone"
                               required="true"/>
                        <div id="phone_error" class="alert alert-error alert-below">
                            <span id="phone_required" class="alert-msg">Phone number is required.</span>
                            <span id="phone_invalid" class="alert-msg">Please enter phone as xxx-xxx-xxxx.</span>
                        </div>

                    </div>
                </div>
                <div class="row">
                    <div class="small-12 medium-12 columns">
                    <textarea name='liveagent.prechat:HowCanWeHelpYou' id='customField7'
                              class="radius description" maxlength="500" rows="3"
                              placeholder="Please explain the issue" required="false"></textarea>
                    <span id="description_required" style="color: red; visibility: hidden;" >Description is required.</span>             
                    </div>
                </div>
                <div class="row">
                <div class="small-12 medium-12 columns" id='offline_Text_Display' style="visibility: hidden;">
                       
                    Chat is currently unavailable. Your issue will be submitted and a Support Engineer will contact you within 48 hours.
                </div>
            </div>
            <div class="row" >
                <div class="small-12 medium-12 columns" display="inline-block">
                    <input type='submit'
                               name="submit"
                               id='prechat_submit'
                               class="button radius prechat-submit-button"
                           margin-right="10px"
                           value="start chat"
                           style="margin: 10px;"
                           onclick="buttonClicked='start chat'"/>
                    <input type='submit'
                           name="submit"
                           id='submit_button'
                           class="button radius prechat-submit-button"
                           value="submit"
                           style="margin: 10px;"
                           onclick="buttonClicked='submit'"/>
                    </div>
                </div>


            </div>

            <input type="hidden" name="liveagent.prechat.findorcreate.map:Contact" value="Email,Email Address" />
            <input type="hidden" name="liveagent.prechat.findorcreate.map.doFind:Contact" value="Email,true" />
            <input type="hidden" name="liveagent.prechat.findorcreate.map.isExactMatch:Contact" value="Email,true" />
            <input type="hidden" name="liveagent.prechat.findorcreate.saveToTranscript:Contact" value="ContactId" />
            

            <input type="hidden" name="liveagent.prechat.name" id='windowName' />

            <input type="hidden" name="liveagent.prechat.save:Visitor First Name" value="First_Name__c" />
            <input type="hidden" name="liveagent.prechat.save:Visitor Last Name" value="Last_Name__c" />
            <input type="hidden" name="liveagent.prechat.save:Visitor Email Address" value="Email_Address__c"/>
            <input type="hidden" name="liveagent.prechat.save:Visitor Phone Number" value="Phone_Number__c" />
            <input type="hidden" name="liveagent.prechat.save:CaseNumber" value="Case_Number__c" />
            <input type="hidden" name="liveagent.prechat.save:Issue Category" value="Related_To__c" />
            <input type="hidden" name="liveagent.prechat.save:HowCanWeHelpYou" value="How_can_we_help_you__c" />

        </form>
    </div>
<div id="loadingImageWindow" style="display:none" class="loadingImageWindowStyle">
    <apex:image url="{!$Resource.LiveAgentSubmitButtonLoaderImage}" width="50%" height="20%" />
</div>
<div id="closeWindowDiv" width="100%" height="100%" style="display:none;padding-left: 15px;padding-right: 15px;" class="closeWindowStyle">   
    <div  class="row" align="center"   style="background-color: white;">
        <div align="center">
                <c:LiveChatSunpowerImage />
        </div>
        <div align="left" style="font-size: x-large;background-color: white;">
                Contact Support
        </div>
        <hr></hr>
    <div align="left" style="font-size: large;padding-top: 2%;padding-bottom: 2%;">Your issue has been submitted. You will receive an email response within 48 hours.</div>
    <hr style="padding-top: 2%;"></hr>

<div class="small-12 medium-12 columns" display="inline-block">
                <input type='button'
                       name="submit"
                       id='gotIt'
                       class="buttonGotIt "
                       onclick="window.close();return false"
                       style="float: right;"
                       value="got It!"/>
</div>
</div>
</div>
    <script type='text/javascript'>
if (isAvailable == true) {
    document.getElementById("submit_button").style.display = "none";
    document.getElementById("prechat_submit").style.display = "block";
} else {
    document.getElementById("prechat_submit").style.display = "none";
    document.getElementById("submit_button").style.display = "block";
    document.getElementById("offline_Text_Display").style.visibility = "visible";
}

        var delay = 500;

        //===========================
        // VALIDATE SELECT
        //===========================
        function isValidSelect(option) {
            return option != "default";
        };

        function validateIssueCategory(e, noDelay) {
            delay = noDelay ? 0 : delay;
            var option = $('#issueCategory').val();

            if (option == "default") {
        // $('#option_error').addClass('alert-show');
        // $('#option_required').addClass('alert-msg-show');
        document.getElementById("option_error").style.visibility = "visible";
                return false; // not valid
            } else {
        //$('#option_error').removeClass('alert-show');
        // $('#option_required').removeClass('alert-msg-show');
        document.getElementById("option_error").style.visibility = "hidden";
                return true; // valid
            }
        }

        $('#issueCategory').change(validateIssueCategory);
$('#customField7').change(validateDescriptionField);

        //===========================
        // VALIDATE NAME
        //===========================
        nameMinLength = 2;
        function isValidName(name){
            return name.length >= nameMinLength;
        }

        var invalidFirstNameTimer;
        function validateFirstName(e, noDelay) {
            delay = noDelay ? 0 : delay;
            var firstName = $('#customField1').val();
            window.clearTimeout(invalidFirstNameTimer);

            if (firstName.length == 0) {
                invalidFirstNameTimer = window.setTimeout(function() {
                    $('#firstName_error').addClass('alert-show');
                    $('#firstName_required').addClass('alert-msg-show');
                    $('#firstName_min').removeClass('alert-msg-show');
                }, delay);
                return false; // invalid
            } else if (!isValidName(firstName)) {
                invalidFirstNameTimer = window.setTimeout(function() {
                    $('#firstName_error').addClass('alert-show');
                    $('#firstName_min').addClass('alert-msg-show');
                    $('#firstName_required').removeClass('alert-msg-show');
                }, delay);
                return false; // invalid
            } else {
                $('#firstName_error').removeClass('alert-show');
                $('#firstName_min').removeClass('alert-msg-show');
                $('#firstName_required').removeClass('alert-msg-show');
                return true; // valid
            }
        }
        $('#customField1').on('focusout keyup', validateFirstName);

        var invalidLastNameTimer;
        function validateLastName(e, noDelay) {
            delay = noDelay ? 0 : delay;
            var lastName = $('#customField2').val();
            window.clearTimeout(invalidLastNameTimer);

            if (lastName.length == 0) {
                invalidLastNameTimer = window.setTimeout(function() {
                    $('#lastName_error').addClass('alert-show');
                    $('#lastName_required').addClass('alert-msg-show');
                    $('#lastName_min').removeClass('alert-msg-show');
                }, delay);
                return false; // invalid
            } else if (!isValidName(lastName)) {
                invalidLastNameTimer = window.setTimeout(function() {
                    $('#lastName_error').addClass('alert-show');
                    $('#lastName_min').addClass('alert-msg-show');
                    $('#lastName_required').removeClass('alert-msg-show');
                }, delay);
                return false; // invalid
            } else {
                $('#lastName_error').removeClass('alert-show');
                $('#lastName_min').removeClass('alert-msg-show');
                $('#lastName_required').removeClass('alert-msg-show');
                return true; // valid
            }
        }

        $('#customField2').on('focusout keyup', validateLastName);

        //===========================
        // VALIDATE EMAIL
        //===========================
        function isValidEmailAddress(emailAddress) {
            var pattern = /^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;
            return pattern.test(emailAddress);
        };

        var invalidEmailTimer;
        function validateEmail(e, noDelay) {
            delay = noDelay ? 0 : delay;
            var email = $('#customField3').val();
            window.clearTimeout(invalidEmailTimer);

            if (email.length == 0) {
                invalidEmailTimer = window.setTimeout(function() {
                    $('#email_error').addClass('alert-show');
                    $('#email_required').addClass('alert-msg-show');
                    $('#email_invalid').removeClass('alert-msg-show');
                }, delay);
                return false; // invalid
            } else if (!isValidEmailAddress(email)) {
                invalidEmailTimer = window.setTimeout(function() {
                    $('#email_error').addClass('alert-show');
                    $('#email_invalid').addClass('alert-msg-show');
                    $('#email_required').removeClass('alert-msg-show');
                }, delay);
                return false; // invalid
            } else {
                $('#email_error').removeClass('alert-show');
                $('#email_invalid').removeClass('alert-msg-show');
                $('#email_required').removeClass('alert-msg-show');
                return true; // valid
            }
        }
        $('#customField3').on('focusout keyup', validateEmail);

        //===========================
        // VALIDATE PHONE
        //===========================
        function isValidPhoneNumber(phoneNumber) {
            phoneNumber = phoneNumber.trim();
            var pattern = /^\(?\d{3}\)? ?-? ?\d{3} ?-? ?\d{4}$/;
            var isValidPattern =  pattern.test(phoneNumber);


            return isValidPattern;

        };

        var invalidPhoneTimer;
        function validatePhone(e, noDelay) {
            delay = noDelay ? 0 : delay;
            var phone = $('#customField4').val();
            window.clearTimeout(invalidPhoneTimer);

            if (phone.length == 0) {
                invalidPhoneTimer = window.setTimeout(function() {
                    $('#phone_error').addClass('alert-show');
                    $('#phone_required').addClass('alert-msg-show');
                    $('#phone_invalid').removeClass('alert-msg-show');
                }, delay);
                return false; // invalidate
            } else if (!isValidPhoneNumber(phone)) {
                invalidPhoneTimer = window.setTimeout(function() {
                    $('#phone_error').addClass('alert-show');
                    $('#phone_invalid').addClass('alert-msg-show');
                    $('#phone_required').removeClass('alert-msg-show');
                }, delay);
                return false; // invalidate
            } else {
                $('#phone_error').removeClass('alert-show');
                $('#phone_invalid').removeClass('alert-msg-show');
                $('#phone_required').removeClass('alert-msg-show');
                return true; // valid
            }
        }
        $('#customField4').on('focusout keyup', validatePhone);

        //===========================
        // VALIDATE FORM
        //===========================


        function validate() {

            var noErrorDisplayDelay = true;
    setName();
            var validOption = validateIssueCategory(null, noErrorDisplayDelay);
            var validFirstName = validateFirstName(null, noErrorDisplayDelay);
            var validLastName = validateLastName(null, noErrorDisplayDelay);
            var validEmail = validateEmail(null, noErrorDisplayDelay);
            var validPhone = validatePhone(null, noErrorDisplayDelay);
            var descriptionValidation=validateDescriptionField();
    if ( validOption && validFirstName && validLastName && validEmail && validPhone && descriptionValidation ) {
        if (isAvailable == true && buttonClicked =='start chat' ) {
            return true; 
        }
        else{
            if(descriptionValidation){
            var visitor = new sforce.SObject("LiveChatVisitor");
            sforce.connection.create([visitor], {onSuccess : visitorSuccess, onFailure : visitorFailure});
            document.getElementById("chat-form-container").style.display = "none";
                document.getElementById("loadingImageWindow").style.display = "block";
            }
        }
            } else {
                console.log('not valid', validOption, validFirstName, validLastName, validEmail, validPhone);
            }
    return false;
        }
function check(){
        
        $("form").on('submit', function (e) {
          
              validate();
           //stop form submission
               e.preventDefault();
        });
}
function visitorSuccess(result) {
    if (result[0].getBoolean("success")) {
        myLog("new visitor created with id " + result[0].id);
        var transcript = new sforce.SObject("LiveChatTranscript");
        transcript.Status = "Missed";
        transcript.LiveChatVisitorId = result[0].id;
        transcript.LiveChatButtonId = button_id;
        transcript.First_Name__c = document.getElementById("customField1").value;
        transcript.Last_Name__c = document.getElementById("customField2").value;
        transcript.Email_Address__c = document.getElementById("customField3").value;
        transcript.Phone_Number__c = document.getElementById("customField4").value;
        transcript.How_can_we_help_you__c = document.getElementById("customField7").value;
        var relatedToSelector = document.getElementById("issueCategory");
        var relatedToFieldValue= relatedToSelector.options[relatedToSelector.selectedIndex].value;
        if (relatedToFieldValue!= null) {
            transcript.Related_To__c = relatedToFieldValue;
        }
        transcript.RequestTime = new Date().toISOString();
        if (window.navigator) {
            if (window.navigator.userAgent) {
                transcript.UserAgent = window.navigator.userAgent.substring(0,200);
            }
            if (window.navigator.platform) {
                transcript.Platform = window.navigator.platform.substring(0,200);
            }
            if (window.navigator.language) {
                transcript.BrowserLanguage = window.navigator.language.substring(0,200);
            }
            window.navigator.sayswho = (function(){
                var ua = navigator.userAgent, tem,
                    M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
                if(/trident/i.test(M[1])){
                    tem =  /\brv[ :]+(\d+)/g.exec(ua) || [];
                    return 'IE '+(tem[1] || '');
                }
                if(M[1] === 'Chrome'){
                    tem = ua.match(/\b(OPR|Edge)\/(\d+)/);
                    if(tem != null) return tem.slice(1).join(' ').replace('OPR', 'Opera');
                }
                M = M[2]? [M[1], M[2]]: [navigator.appName, navigator.appVersion, '-?'];
                if((tem = ua.match(/version\/(\d+)/i))!= null) M.splice(1, 1, tem[1]);
                return M.join(' ');
            })();
            if (window.navigator.sayswho) {
                transcript.Browser = window.navigator.sayswho.substring(0,200);
            }
        }
        var w = window.outerWidth || document.documentElement.clientWidth || document.body.clientWidth;
        var h = window.outerHeight || document.documentElement.clientHeight || document.body.clientHeight;
        transcript.ScreenResolution = (w + 'x' + h).substring(0,200);
                sforce.connection.create([transcript], {onSuccess : transcriptSuccess, onFailure : transcriptFailure});
    } else {
        alert("Failed to create visitor " + result[0]);
    }
}
function visitorFailure(error) {
    alert("Error while creating visitor " + error);
}
function transcriptSuccess(result) {
    if (result[0].getBoolean("success")) {
        myLog("new transcript created with id " + result[0].id);
    } else {
        alert("Failed to create transcript " + result[0]);
    }
    //document.getElementById("gotIt").removeAttribute("disabled");
    document.getElementById("loadingImageWindow").style.display = "none";
    document.getElementById("closeWindowDiv").style.display = "block";
}
function transcriptFailure(error) {
    alert("Error while creating transcript " + error);
    // document.getElementById("gotIt").removeAttribute("disabled");
    document.getElementById("loadingImageWindow").style.display = "none";
    document.getElementById("closeWindowDiv").style.display = "block";
}
function myLog(value) {
    if (window.console && window.console.log) window.console.log(value);
}
//Validate description field if empty
function validateDescriptionField(){
    var descriptionText = document.getElementById("customField7").value;
    if(descriptionText.length<1)
    {
        document.getElementById("description_required").style.visibility = "visible";
        return false;
    }
    else
    {    document.getElementById("description_required").style.visibility = "hidden";
     return true;
    }
}
    </script>
    <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js'></script>
<apex:pageBlock title="Debug" rendered="{!showDebug}" id="debug">
    liveAgentAPIEndpoint: {!liveAgentAPIEndpoint} <br/>
        org_id: {!org_id} <br/>
            deployment_id: {!deployment_id} <br/>
                button_id: {!button_id} <br/>
                    deploymentHostName: {!deploymentHostName} <br/>
                        preChatHostName: {!preChatHostName} <br/>
                            isNotBlankSessionId: {!isNotBlankSessionId} <br/>
                                availabilityStatus: {!availabilityStatus} <br/>
                                    availabilityStatusCode: {!availabilityStatus} <br/>
                                        availabilityRequestBody: {!availabilityRequestBody} <br/>
                                            availabilityMessages: {!availabilityMessages} <br/>
                                                availabilityType: {!availabilityType} <br/>
                                                    isAvailable: {!isAvailable} <br/>
                                                        getVisitorLocation: {!getVisitorLocation} <br/>
                                                            </apex:pageBlock>
</apex:page>