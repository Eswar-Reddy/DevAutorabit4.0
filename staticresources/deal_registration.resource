var dependentListeners = false;var isCprQuote = false;ï»¿$(document).ready(function() {	setupListeners();});function setupListeners() {	$('select[id$="country"]').change( function( event ) {		setupDependentListeners();	});		setupDependentListeners();}function setupDependentListeners() {	if( $('select[id$="country"]').val() == 'United States' ) {	 	$('input[id$="validatedAddress"]').val( false );		$('input[id$="zipCode1"]').change(function( event ) {			if ( !dependentListeners ) {				dependentListeners = true;			 	$('input[id$="state1"]').change( function(event){ validateAddress();} );			 	$('input[id$="city1"]').change( function(event){ validateAddress();} );			} 			if ( event.target.value != undefined && event.target.value.length >= 5 ) {				validateAddress();			}		});	}	else {		$('input[id$="zipCode1"]').unbind('change');	 	$('input[id$="state1"]').unbind('change');	 	$('input[id$="city1"]').unbind('change');	 	dependentListeners = false;	 	$('input[id$="validatedAddress"]').val( true );	}}function validateAndSave() {	if( $('select[id$="country"]').val() == 'United States' ) {	 	$('input[id$="validatedAddress"]').val( false );		var zipcode = $('input[id$="zipCode1"]').val();		AccountExtension.checkAddressInformation( zipcode, handleValidationSave );	}	else {		callSave();		}}function handleValidationSave(result, event) {	handleValidation(result, event);	if ( $('input[id$="validatedAddress"]').val() ){		callSave();	}	setupListeners();}function callSave() {	if ( isCprQuote ) {		save_and_quote();	}	else {		save();	}}function validateAddress() {	 	$('input[id$="validatedAddress"]').val( false );	var zipcode = $('input[id$="zipCode1"]').val();	AccountExtension.checkAddressInformation( zipcode, handleValidation );}function chooseCity(obj, city, state, county ){	$('#citySelectionDialog').dialog('close'); 	$('input[id$="state1"]').val( state ); 	$('input[id$="city1"]').val( city ); 	$('input[id$="oracleCounty"]').val( county ); 	$('input[id$="validatedAddress"]').val( true );}function handleValidation( result, event ) {	if(event.type == 'exception') {		alert(event.message);	}		if ( result.length >= 1 ){		city = $('input[id$="city1"]').val();				var matchedCity = false;				for ( i=0; i < result.length; i++ ) {			if ( result[i].Geo_City__c == city ){ 			 	$('input[id$="city1"]').val( result[i].Geo_City__c );			 	matchedCity = true;				chooseCity(this, result[i].Geo_City__c, result[i].Geo_State__c, result[i].Geo_County__c); 			 	break;		 	}		}				if ( !matchedCity ) {			//build a set of city choices (in html for dialog)			var cityChoicesHtml = '<p>';			for ( i=0; i < result.length; i++ ) {				cityChoicesHtml += '<a href="#" onclick="chooseCity(this,\''+result[i].Geo_City__c+'\',\''+result[i].Geo_State__c+'\',\''+result[i].Geo_County__c+'\');">'+result[i].Geo_City__c+', '+result[i].Geo_County__c+', '+ result[i].Geo_State__c+', '+ result[i].Geo_Postal_Code__c+'</a></br>';			}			cityChoicesHtml += '</p>';						//instantiate dialog w/ choices			$('#citySelectionDialog p').html( cityChoicesHtml );			$('#citySelectionDialog').dialog({ 												modal : true,												title : 'Choose Validated City'			});		}	}	else {		alert( 'This zipcode is not a valid zipcode.');	}}function navigateToCpr( cprUrl, currentPageUrl ) {	var navigateHtml = '<p>Customer created successfully.  Click <a href="' + cprUrl + '" onclick="currentPageRedirect(\'' + currentPageUrl + '\');" target="_blank">here</a> to create your quote.</p>';		//instantiate dialog for navigation	$('#navigateToCprDialog p').html( navigateHtml );	$('#navigateToCprDialog').dialog({ 										modal : true,										title : 'Quick Quotes',										buttons: { 'Cancel': function() { currentPageRedirect( currentPageUrl ); } },										close: function(event, ui) { currentPageRedirect( currentPageUrl ); }	});}function openCprQuotePage( actId, contId, oppId, currentPageUrl ) {	var cprUrl = '/apex/CprIntegration?accountId='+actId+'&contactId='+contId+'&opportunityId='+oppId;		navigateToCpr( cprUrl, currentPageUrl );}function currentPageRedirect( url ) {	window.open( url, "_self" );}